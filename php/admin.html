<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo</title>
    <style>
        /* Reset and Basic Setup */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Roboto', 'Segoe UI', Helvetica, Arial, sans-serif;
            background-color: #F5F5F5; /* Page Background */
            color: rgba(0, 0, 0, 0.87); /* On Surface - High Emphasis */
            display: flex;
            flex-direction: column; /* Allow header and content stacking */
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            background-color: #FFFFFF; /* Surface for container */
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 700px; /* Max width for the panel content */
            margin-top: 20px;
        }

        h1 { /* Page Title */
            font-size: 2.25rem; /* Adjusted from 2.5rem */
            font-weight: 400;
            color: #6200EE; /* Primary Color */
            text-align: center;
            margin-bottom: 24px;
        }

        h2 { /* Section Title */
            font-size: 1.5rem; /* Adjusted from 1.8rem */
            font-weight: 500;
            color: rgba(0,0,0,0.87);
            text-align: center;
            margin-bottom: 20px;
            margin-top: 16px; /* Space above section titles */
        }

        /* Login Section Specifics */
        #loginSection {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Input Field Group (Material Filled Style) */
        .input-field-group {
            position: relative;
            margin-bottom: 24px;
            background-color: rgba(0, 0, 0, 0.04); /* Light fill for the input */
            border-top-left-radius: 4px;
            border-top-right-radius: 4px;
            padding-top: 20px; /* Space for label to float */
            width: 100%;
            max-width: 350px; /* Max width for input group */
            border-bottom: 1px solid rgba(0, 0, 0, 0.42); /* Bottom line - medium emphasis */
            transition: border-bottom-color 0.2s ease, background-color 0.2s ease;
        }

        .input-field-group:hover {
            background-color: rgba(0, 0, 0, 0.08);
            border-bottom-color: rgba(0, 0, 0, 0.87); /* Bottom line - high emphasis on hover */
        }

        .input-field-group input[type="password"] {
            display: block;
            width: 100%;
            padding: 8px 12px;
            font-size: 1rem;
            color: rgba(0,0,0,0.87);
            background-color: transparent;
            border: none;
            outline: none;
        }

        .input-field-group label {
            position: absolute;
            top: 24px; /* Vertically center with input padding */
            left: 12px;
            font-size: 1rem;
            color: rgba(0, 0, 0, 0.6); /* Medium emphasis */
            pointer-events: none;
            transition: top 0.2s ease, font-size 0.2s ease, color 0.2s ease;
        }

        /* Floating label effect */
        .input-field-group input[type="password"]:focus + label,
        .input-field-group input[type="password"]:not(:placeholder-shown) + label {
            top: 6px; /* Move label up */
            font-size: 0.75rem;
            color: #6200EE; /* Primary color for focused/filled label */
        }

        /* Underline effect for focus */
        .input-field-group::after { /* Create a pseudo-element for the underline */
            content: '';
            display: block;
            position: absolute;
            bottom: -1px; /* Align with the border-bottom or overlap it */
            left: 0;
            width: 100%;
            height: 2px; /* Thickness of the underline */
            background-color: #6200EE; /* Primary color for the underline */
            transform: scaleX(0); /* Initially hidden */
            transition: transform 0.2s ease-out;
        }

        .input-field-group input[type="password"]:focus ~ label,
        .input-field-group input[type="password"]:focus + label {
             color: #6200EE;
        }

        .input-field-group input[type="password"]:focus ~ .input-line,
        .input-field-group:focus-within::after {
            transform: scaleX(1);
        }
         .input-field-group:focus-within {
             border-bottom-color: transparent;
         }


        #loginError {
            color: #B00020; /* Error Color */
            margin-top: -8px; /* Pull closer to input */
            margin-bottom: 16px;
            min-height: 1.2em;
            font-size: 0.875rem;
            text-align: center;
            width: 100%;
            max-width: 350px;
        }

        /* Buttons (Material Contained Style) */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0 16px;
            height: 36px;
            border: none;
            border-radius: 4px;
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            cursor: pointer;
            outline: none;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            transition: box-shadow 0.2s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.2s ease;
            overflow: hidden;
            position: relative;
        }

        .btn:hover, .btn:focus {
            box-shadow: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);
        }

        .btn:active {
            box-shadow: 0 1px 2px rgba(0,0,0,0.16);
        }


        .btn .btn-icon {
            margin-right: 8px;
            display: inline-flex;
            align-items: center;
        }
        .btn .btn-icon svg {
            width: 18px; /* Default for button icons */
            height: 18px;
            fill: currentColor;
        }
        .btn .btn-icon:only-child {
            margin-right: 0;
        }


        .btn-primary {
            background-color: #6200EE;
            color: #FFFFFF;
        }
        .btn-primary:hover, .btn-primary:focus {
            background-color: #5e00e4;
        }
        .btn-primary:active { background-color: #3700B3; }


        #loginButton {
            width: 100%;
            max-width: 350px;
            margin-top: 8px;
        }

        /* Admin Content Section */
        #adminContent {
            width: 100%;
        }

        #pendingGamesList {
            margin-top: 16px;
            margin-bottom: 24px;
        }

        /* Game Item Card Styling */
        .card {
            background-color: #FFFFFF;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 16px;
            overflow: hidden;
        }

        .card-header {
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(0,0,0,0.08);
        }

        .card-header .game-name {
            font-size: 1.25rem;
            font-weight: 500;
            color: rgba(0,0,0,0.87);
        }

        .card-header .game-status {
            display: inline-flex;
            align-items: center;
            font-size: 0.875rem;
            font-weight: 500;
            padding: 4px 8px;
            border-radius: 4px;
        }
        .card-header .game-status .status-icon {
            margin-right: 6px;
            display: inline-flex;
            align-items: center;
        }
        .card-header .game-status .status-icon svg {
            width: 16px; /* Smaller for status indicators */
            height: 16px;
            /* fill is handled by specific status class */
        }

        /* Status specific styles */
        .status-text_pending {
            color: #FFA000;
        }
        .status-icon_pending svg {
            fill: #FFA000;
        }
        .status-text_approved { color: #4CAF50; }
        .status-icon_approved svg { fill: #4CAF50; }
        .status-text_rejected { color: #D32F2F; }
        .status-icon_rejected svg { fill: #D32F2F; }


        .card-content {
            padding: 16px;
            font-size: 0.9rem;
            color: rgba(0,0,0,0.6);
        }
        .card-content p {
            margin-bottom: 8px;
        }
        .card-content p:last-child {
            margin-bottom: 0;
        }
        .card-content .game-url {
            word-break: break-all;
        }

        .card-actions {
            padding: 8px 16px;
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            border-top: 1px solid rgba(0,0,0,0.08);
        }

        .btn-success {
            background-color: #4CAF50;
            color: white;
        }
        .btn-success:hover, .btn-success:focus { background-color: #43A047; }
        .btn-success:active { background-color: #388E3C; }

        .btn-danger {
            background-color: #D32F2F;
            color: white;
        }
        .btn-danger:hover, .btn-danger:focus { background-color: #C62828; }
        .btn-danger:active { background-color: #B71C1C; }


        #logoutButton {
            margin: 16px auto 0;
            display: block;
            width: fit-content;
        }

        /* Message for no pending games */
        #pendingGamesList p {
            text-align: center;
            padding: 20px;
            font-size: 1rem;
            color: rgba(0,0,0,0.6);
        }


        /* Hidden class */
        .hidden {
            display: none !important;
        }

        /* Responsive Adjustments */
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 16px;
                margin-top: 10px;
            }
            h1 { font-size: 1.8rem; margin-bottom: 20px; }
            h2 { font-size: 1.3rem; margin-bottom: 16px; }

            .input-field-group { max-width: none; }
            #loginButton { max-width: none; }

            .card-header { flex-direction: column; align-items: flex-start; gap: 8px;}
            .card-actions { justify-content: center; flex-wrap: wrap; }
            .card-actions .btn { width: 100%; margin-bottom: 8px; }
            .card-actions .btn:last-child { margin-bottom: 0; }

            #logoutButton { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Painel Administrativo</h1>

        <div id="loginSection">
            <h2>Login</h2>
            <p id="loginError"></p>
            <div class="input-field-group">
                <input type="password" id="password" placeholder=" " required>
                <label for="password">Senha</label>
            </div>
            <button id="loginButton" class="btn btn-primary" onclick="login()">
                <span class="btn-icon"><svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 0 24 24" width="18px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M10 17l5-5-5-5v3H2v4h8v3z"/></svg></span>
                <span class="btn-text">Entrar</span>
            </button>
        </div>

        <div id="adminContent" class="hidden">
            <h2>Jogos Pendentes</h2>
            <div id="pendingGamesList">
                <!-- Game items will be dynamically inserted here -->
            </div>
            <button id="logoutButton" class="btn btn-danger logout-btn" onclick="logout()">
                <span class="btn-icon"><svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 0 24 24" width="18px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5-5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg></span>
                <span class="btn-text">Sair</span>
            </button>
        </div>
    </div>

    <script>
        const ADMIN_PHP = 'admin.php';
        let sessionToken = null;

        function escapeHTML(str) {
            if (typeof str !== 'string') return '';
            return str.replace(/[&<>"']/g, function (match) {
                return { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[match];
            });
        }

        async function loadPendingGames() {
            if (!sessionToken) {
                document.getElementById('loginError').textContent = 'Não está logado ou a sessão expirou.';
                logout();
                return;
            }
            const listDiv = document.getElementById('pendingGamesList');
            listDiv.innerHTML = '';

            try {
                const response = await fetch(`${ADMIN_PHP}?action=list_pending&token=${encodeURIComponent(sessionToken)}`);
                if (!response.ok) {
                    let errorMsg = `<p style="color:red">Erro ao carregar jogos: ${response.status} ${response.statusText}</p>`;
                    try {
                        const errorResult = await response.json();
                        if (errorResult.message) {
                            errorMsg += `<br>${errorResult.message}`;
                            if (response.status === 401 || (errorResult.message && errorResult.message.toLowerCase().includes('session'))) logout();
                        }
                    } catch (e) { /* Ignore */ }
                    listDiv.innerHTML = errorMsg;
                    return;
                }
                const games = await response.json();

                if (games.success === false && games.message) {
                    listDiv.innerHTML = `<p style="color:red">${games.message}</p>`;
                     if (response.status === 401 || (games.message && games.message.toLowerCase().includes('session'))) logout();
                    return;
                }

                if (!Array.isArray(games)) {
                     listDiv.innerHTML = '<p style="color:red">Resposta inesperada do servidor ao carregar jogos.</p>';
                     console.error("Expected array of games, got:", games);
                     return;
                }

                if (games.length === 0) {
                    listDiv.innerHTML = '<p>Nenhum jogo pendente.</p>';
                    return;
                }

                games.forEach(game => {
                    const item = document.createElement('div');
                    item.className = 'game-item card';

                    const gameName = game.name || 'Nome Indisponível';
                    const gameSize = game.size || 'Tamanho Indisponível';
                    const gameUrl = game.url || 'URL Indisponível';
                    const gameStatus = game.status || 'desconhecido';
                    const statusClassSuffix = gameStatus.toLowerCase();

                    const statusIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 0 24 24" width="16px"><path d="M0 0h24v24H0z" fill="none"/><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>`;
                    const approveIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 0 24 24" width="18px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>`;
                    const rejectIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 0 24 24" width="18px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"/></svg>`;

                    item.innerHTML = `
                        <div class="card-header">
                            <strong class="game-name">${escapeHTML(gameName)}</strong>
                            <span class="game-status">
                                <span class="icon status-icon status-icon_${statusClassSuffix}">${statusIconSVG}</span>
                                <span class="status-text status-text_${statusClassSuffix}">${escapeHTML(gameStatus)}</span>
                            </span>
                        </div>
                        <div class="card-content">
                            <p class="game-size">Tamanho: ${escapeHTML(gameSize)}</p>
                            <p class="game-url">URL: ${escapeHTML(gameUrl)}</p>
                        </div>
                        <div class="card-actions">
                            <button class="btn btn-success approve-btn" onclick="approveGame('${escapeHTML(gameName)}')">
                                <span class="btn-icon approve-icon">${approveIconSVG}</span>
                                <span class="btn-text">Aprovar</span>
                            </button>
                            <button class="btn btn-danger reject-btn" onclick="rejectGame('${escapeHTML(gameName)}')">
                                <span class="btn-icon reject-icon">${rejectIconSVG}</span>
                                <span class="btn-text">Rejeitar</span>
                            </button>
                        </div>
                    `;
                    listDiv.appendChild(item);
                });
            } catch (error) {
                console.error('loadPendingGames error:', error);
                listDiv.innerHTML = '<p style="color:red">Não foi possível buscar os jogos pendentes. Verifique o console.</p>';
            }
        }

        async function login() {
            const passwordInput = document.getElementById('password');
            const password = passwordInput.value;
            const loginErrorP = document.getElementById('loginError');
            loginErrorP.textContent = '';

            if (!password) {
                loginErrorP.textContent = 'A senha não pode estar vazia.';
                return;
            }

            try {
                const response = await fetch(ADMIN_PHP, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: `action=login&password=${encodeURIComponent(password)}`
                });

                if (!response.ok) {
                    let errorMsg = `Falha no login: ${response.status} ${response.statusText}`;
                    try {
                        const errorResult = await response.json();
                        if (errorResult.message) {
                             errorMsg += ` - ${errorResult.message}`;
                        }
                    } catch (e) { /* Ignore */ }
                    loginErrorP.textContent = errorMsg;
                    sessionToken = null;
                    return;
                }

                const result = await response.json();

                if (result.success && result.token) {
                    sessionToken = result.token;
                    document.getElementById('loginSection').classList.add('hidden');
                    document.getElementById('adminContent').classList.remove('hidden');
                    passwordInput.value = '';
                    loadPendingGames();
                } else {
                    loginErrorP.textContent = result.message || 'Falha no login. Motivo desconhecido.';
                    sessionToken = null;
                }
            } catch (error) {
                console.error('Erro na função de login:', error);
                loginErrorP.textContent = 'Erro de login: Não foi possível conectar ou processar a resposta. Verifique o console.';
                sessionToken = null;
            }
        }

        async function approveGame(name) {
            if (!sessionToken) {
                alert('Sessão expirada. Por favor, faça login novamente.');
                logout();
                return;
            }
            if (!confirm(`Tem certeza que deseja aprovar o jogo: ${name}?`)) return;

            const gameNameEncoded = encodeURIComponent(name);
            const tokenEncoded = encodeURIComponent(sessionToken);

            try {
                const response = await fetch(`${ADMIN_PHP}?action=approve&name=${gameNameEncoded}&token=${tokenEncoded}`, { method: 'POST' });
                 if (!response.ok) {
                    let errorMsg = `Erro ao aprovar: ${response.status} ${response.statusText}`;
                    try {
                        const errorResult = await response.json();
                        if (errorResult.message) errorMsg += ` - ${errorResult.message}`;
                        if (response.status === 401 || (errorResult.message && errorResult.message.toLowerCase().includes('session'))) {
                             alert(errorResult.message || 'Sessão inválida ou expirada.');
                             logout();
                        } else {
                            alert(errorMsg);
                        }
                    } catch (e) { alert(errorMsg); }
                    return;
                }
                const result = await response.json();
                if (result.success) {
                    loadPendingGames();
                } else {
                    alert('Erro ao aprovar o jogo: ' + (result.message || 'Erro desconhecido'));
                     if (result.message && result.message.toLowerCase().includes('session')) logout();
                }
            } catch (error) {
                console.error("Approve game error:", error);
                alert("Erro de rede ao aprovar o jogo.");
            }
        }

        async function rejectGame(name) {
            if (!sessionToken) {
                alert('Sessão expirada. Por favor, faça login novamente.');
                logout();
                return;
            }
            if (!confirm(`Tem certeza que deseja rejeitar o jogo: ${name}?`)) return;

            const gameNameEncoded = encodeURIComponent(name);
            const tokenEncoded = encodeURIComponent(sessionToken);

            try {
                const response = await fetch(`${ADMIN_PHP}?action=reject&name=${gameNameEncoded}&token=${tokenEncoded}`, { method: 'POST' });
                if (!response.ok) {
                    let errorMsg = `Erro ao rejeitar: ${response.status} ${response.statusText}`;
                    try {
                        const errorResult = await response.json();
                        if (errorResult.message) errorMsg += ` - ${errorResult.message}`;
                         if (response.status === 401 || (errorResult.message && errorResult.message.toLowerCase().includes('session'))) {
                            alert(errorResult.message || 'Sessão inválida ou expirada.');
                            logout();
                        } else {
                            alert(errorMsg);
                        }
                    } catch (e) { alert(errorMsg); }
                    return;
                }
                const result = await response.json();
                if (result.success) {
                    loadPendingGames();
                } else {
                    alert('Erro ao rejeitar o jogo: ' + (result.message || 'Erro desconhecido'));
                    if (result.message && result.message.toLowerCase().includes('session')) logout();
                }
            } catch (error) {
                console.error("Reject game error:", error);
                alert("Erro de rede ao rejeitar o jogo.");
            }
        }

        function logout() {
            sessionToken = null;
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('adminContent').classList.add('hidden');
            document.getElementById('pendingGamesList').innerHTML = '';
            document.getElementById('password').value = '';
            document.getElementById('loginError').textContent = '';
        }
    </script>
</body>
</html>
